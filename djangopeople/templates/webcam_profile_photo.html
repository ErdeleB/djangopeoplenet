{% extends "base_no_map.html" %}

{% block title%}Webcam a profile photo |{% endblock %}

{% block js %}{% load thumbnail %}{% endblock %}
{% block map %}{% endblock %}

    {% block content %}
        <script type="text/javascript" src="/webcam/webcam.js"></script>
	<script language="JavaScript">
		webcam.set_quality( 85 ); // JPEG quality (1 - 100)
		webcam.set_shutter_sound( true ); // play shutter click sound
                webcam.swf_url = '/webcam/webcam.swf';
                webcam.shutter_url = '/webcam/shutter.mp3';
	</script>

	<script language="JavaScript">
		webcam.set_hook( 'onComplete', 'my_completion_handler' );
                
                function capture_and_dump() {
                    webcam.freeze();
                    setTimeout(function() {
                      webcam.dump();
                    }, 500);
                    
                    setTimeout(function() {
                      webcam.reset();
                    }, 500);
                }
                
                function discard_preview() {
                    $('#id_image_data').val('');
                    $('#snap_button').val("Snap!");
                    $('#preview-new-photo:visible').hide();
                    
                }
		
		function do_capture() {
			webcam.freeze();
			document.getElementById('capture_button').disabled = true;
			document.getElementById('dump_button').disabled = false;
		}
		
		function do_dump() {
			webcam.dump();
		}

		function do_reset() {
			webcam.reset();
			document.getElementById('capture_button').disabled = false;
			document.getElementById('dump_button').disabled = true;
		}
		
		function my_completion_handler(base64) {
                        $('#preview-new-photo img').attr('src', 'data:image/jpeg;base64,' + base64);
                        $('#your-current-photo:visible').hide();
                        $('#preview-new-photo:hidden').show(100);
                        
                        $('#snap_button').val("Snap again!");
                        $('#id_image_data').val(base64);
                        
			//document.getElementById('img_data').value = base64;
			//document.getElementById('submit_button').disabled = false;
			//do_reset();
		}
	</script>

        <h2>{% if person.photo %}Webcam a new profile photo{% else %}Webcam a profile photo{% endif %}</h2>
	<p><!-- --></p>

        <form enctype="multipart/form-data" method="post" action=".">

        {{ form.image_data.errors }}
        {{ form.image_data }}

        <table>
          <tr>
            <td valign="top" align="center">
			<script language="JavaScript">
			document.write( webcam.get_html(320, 240) );
			</script>
                        <br>
	<!--<div class="form-field-submit">-->
		<div class="button-outer">
    		<div class="buttonContainer">
    		<input id="snap_button" type="button" value="Snap!" onclick="capture_and_dump()"/>
                <a href="#" onclick="webcam.configure();return false;">Configure your webcam</a>
    		</div>
		</div>
	
	<!--</div>-->
            
            </td>
            
            <td valign="top" align="center">
            
        
          <div id="preview-new-photo" style="display:none">
          <img src=""/>
          
         	<div class="form-field-submit">
		<div class="button-outer">
    		<div class="buttonContainer">
    		<input type="submit" value="Upload and save"/>
                <a href="#" onclick="discard_preview();return false;">Oh no! Discard!</a>
    		</div>
		</div>
                </div>
                
             <br style="clear:left">
          </div>
        
            </td>
          </tr>
        </table>
            


        
	
             {% comment %}
	<div class="form-field-outer">
		<div class="form-field-left">
                    {{ form.photo.errors }}
                    <!--<label for="id_photo">Photo</label>-->
		    <input type="button" value="Configure..." onclick="webcam.configure()">
		    <br>
		    <input id="capture_button" type="button" value="Capture" onclick="do_capture()">
                    <input id="snap_button" type="button" value="Snap!" onclick="capture_and_dump()">
                    
		    <br>
		    <input id="dump_button" type="button" value="Insert" onclick="do_dump()" disabled="true">
		    <br>
		    <input type="button" value="Reset" onClick="do_reset()">
		</div>

		<div class="form-field-right">
			
		</div>
	</div>
                {% endcomment %}

           
	



            </form>
        </div>

	<div id="right-column">
	<div class="right-box">
        
        <div id="your-current-photo">
	<h3>Your current photo</h3>
	{% if person.photo %}
		<div class="profile-photo">
 		<img class="photo-left" src="{% thumbnail person.photo 100x100 crop %}">
		</div>
                <p>
                <a href="{% url crop_profile_photo person.user.username %}">Want to crop this one again?</a>
                </p>
	{% else %}
		<img xxxclass="photo-left" src="/img/photo-background-119.png"/>
	{% endif %}
	</div>
        </div>


	</div>
    {% endblock %}
