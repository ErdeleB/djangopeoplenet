{% extends "base.html" %}

{% block title%}{{ person }} |{% endblock %}

{% block nav_li_class_profile %}{% if is_owner %} class="current"{% endif %}{% endblock %}

{% block js %}{% load thumbnail %}
{% if person.latitude and person.longitude %}
<script type="text/javascript">
var nearby_people = [
    // latitude, longitude, name, username, location description, flag, isocode
    {% for p in person.get_nearest %}
    [{{ p.latitude }}, {{ p.longitude }}, "{{ p|escapejs }}", "{{ p.user.username|escapejs }}", "{{ p.location_description|escapejs }}", "{% if p.photo %}{% thumbnail p.photo 40x40 crop %}{% else %}/static/img/person_small_blank.png{% endif %}", "{{ p.country.iso_code|lower }}"]{% if not forloop.last %},{% endif %}
    {% endfor %}
];

var person_latitude = {{ person.latitude }};
var person_longitude = {{ person.longitude }};
</script>
<script type="text/javascript" src="/static/js/profile.js"></script>
<style type="text/css">
#id_skills {
    width: 80%;
}
a.changeloc, h2 a.edit, div.bio a.edit {
    font-size: 0.5em;
    text-decoration: none;
    vertical-align: middle;
}
div.bio a.edit {
    font-size: 0.8em;
}
</style>
{% endif %}

{% endblock %}  


{% block map %}
    <div class="mapContainer minor">
        <div id="gmap">&nbsp;</div>
    </div>
{% endblock %}

{% block content %}

	<div id="content-box">

		{% if is_owner %}
		<div id="floater">
		<ul>
		  <li class="small-text"><a href="/{{ person.user.username }}/upload/" class="meta" id="uploadNewPhoto">Upload a photo</a></li>
		  <li class="small-text"><a href="/{{user.username }}/videos/" class="meta" id="add_video">Videos</a> (<a href="/{{user.username }}/videos/add/" class="meta">add</a>)</li>
		  <li class="small-text"><a href="/{{ user.username }}/location/">Change your location</a></li>
		  <li class="small-text"><a href="/{{ user.username }}/finding/">Update your contact details</a></li>
		  <li class="small-text"><a href="/{{ user.username }}/profile/">Edit your profile information</a></li>
		  <li class="small-text">{% if user.has_usable_password %}<a href="/{{ user.username }}/password/">Change your password</a>{% else %}You do not have a password set - <a href="/{{ user.username }}/password/">set one now?</a>{% endif %}</li>
		</ul>
		</div>

		{% else%}
		<div id="floater">
		{% if person.what_is_kungfu %}<p class="quotation">&ldquo;{{ person.what_is_kungfu }}&rdquo;</p>{% endif %}
		<ul>
		    <li class="small-text"><a href="/{{ person.user.username }}/videos/" class="meta" id="add_video">See {{ person.user.first_name }}'s videos</a></li>
		</ul>
		</div>
		{% endif %}

		{% if person.photo %}
		    <img src="{% thumbnail person.photo 83x83 crop %}" alt="{{ person }}" class="main photo">
		{% else %}
		    <img src="/static/img/upload-a-photo.png" alt="blank image" class="main photo">
		{% endif %}

       		<h3>{{ person.user.get_full_name }}</h3>
        	
		<p class="meta adr">
		<a href="/{{ person.country.iso_code|lower }}/" class="nobg">
		<img src="/static/img/flags/{{ person.country.iso_code|lower }}.gif" alt="{{ person.country }}" title="{{ person.country }}" class="flag country-name">
		</a> 
		<span class="region">{{ person.location_description_html }}</span>
		</p>
		<div class="highlight">
		{% if person.style %}<p><strong>Style:</strong> {{ person.style }}</p>{% endif %}
            	<p>{% filter linebreaks %}{{ person.bio|urlize }}{% endfilter %}</p>               		
		</div>
       
	</div>

	<div id="right-box">
		
		{% if not others %}
		<p>{% if is_owner %}You're {% else %}{{ person.user.get_full_name }} is {% endif %} the only {{ person.style }} stylist in the whole world! <a href="/tell_your_friends">Tell your friends now!</a></p>
		{% else %}
		<h3>Other {{ person.style }} stylists</h3>
		<ul>	        
		{% for person in others %}
		<li><a href="{{ person.get_absolute_url }}">{{ person.user.get_full_name }}</a></li>
		{% endfor %}
		</ul>
		{% endif %}

   		{% with person.get_nearest as people %}
    		{% if people %}
   		<h3>People near {{ person.user.first_name }}</h3>
            	    <ul class="latest-list">
			{% for person in people %}
   		        <li class="latest-list">
   		        <img src="{% if person.photo %}{% thumbnail person.photo 40x40 crop %}{% else %}/static/img/person_small_blank.png{% endif %}" alt="{{ person }}" class="latest-list">
   		         <a href="{{ person.get_absolute_url }}">{{ person }}</a> ({{ person.country.iso_code }})
    		         <p>{{ person.style }}</p>
   			 </li>
    		         {% endfor %}
		    </ul>
   		{% endif %}
   		{% endwith %}
   	</div>

{% endblock %}
