{% extends base_template %}
{% load django_static %}

{% block title%}{{ person }} |{% endblock %}

{% block meta_description %}{{ meta_description }}{% endblock %}
{% block meta_keywords %}{{ meta_keywords }}{% endblock %}

{% block nav_li_class_profile %}{% if is_owner %} class="current"{% endif %}{% endblock %}

{% block js %}{% load thumbnail %}
{% if person.latitude and person.longitude %}
<script type="text/javascript">
// latitude, longitude, name, username, location description, flag, isocode
var nearby_people = [
    {% for p in person.get_nearest %}
    [{{ p.latitude }}, {{ p.longitude }}, "{{ p|escapejs }}", "{{ p.user.username|escapejs }}", "{{ p.location_description|escapejs }}", "{% if p.photo %}{% thumbnail p.photo 40x40 crop %}{% else %}/img/person_small_blank.png{% endif %}", "{{ p.country.iso_code|lower }}"]{% if not forloop.last %},{% endif %}
    {% endfor %}
];

var PAGE_LATITUDE = {{ person.latitude }};
var PAGE_LONGITUDE = {{ person.longitude }};
</script>
<script type="text/javascript" src="{% slimfile "/js/pagemap.js" %}"></script>
<script type="text/javascript" src="{% slimfile "/js/profile.js" %}"></script>
{% if pester_first_photo or pester_first_diary_entry %}
  <script type="text/javascript">
  $(function() {
    $('a.close_tip').click(function() {
      $(this).parents('div.no-photo-box').remove();
      var params = {};
      $.get(document.location.href + $(this).attr('href'));
      return false;
    });
  });
  </script>
{% endif %}

<style type="text/css">
a.changeloc, h2 a.edit, div.bio a.edit {
    font-size: 0.5em;
    text-decoration: none;
    vertical-align: middle;
}
div.bio a.edit {
    font-size: 0.8em;
}
</style>
{% endif %}

{% endblock %}  

	{% block signup %}
	<a href="/signup/">
	<div id="signup">
	<p><strong>Signup today!!</strong></p>
	</div>
	</a>
	{% endblock %}



{% block map %}
    <div class="mapContainer minor">
        <div id="gmap">&nbsp;
        {% if OFFLINE_MODE %}
        <img src="/static/img/map-short-placeholder.png" />
        {% endif %}
        </div>
    </div>
{% endblock %}

{% block content %}
<div class="wrapper">

	<div id="content-box">
	
	
	<div id="profile-head">

		<div id="profile-head-title">
       		<h2>{{ person.user.get_full_name|lower }}</h2>
		</div>
		{% if is_owner %}
		<div id="profile-head-toolbar">
		<p class="meta">
		<a href="/{{ person.user.username }}/profileupload/" id="uploadNewPhoto">{% if person.photo %}Change your photo{% else %}Upload a photo{% endif %}</a>  |  
		<a href="/{{user.username }}/videos/add/">Link to a video</a>  |  
		<a href="/{{ user.username }}/profile/">Edit your profile</a>  
		{% if photos %}{% else %}|  <a href="/{{ user.username }}/photo/upload">Upload photos</a>{% endif %}  
		{% if diary_entries_private %}{% else %}|  <a href="/{{ user.username }}/diary/add">Add a diary entry</a>{% endif %}  |  			<a href="/{{ user.username }}/club/"> Edit clubs</a>  |  
		<a href="/{{ user.username }}/style/">Edit styles</a></p>
		</div>
		{% endif %}



	{% if is_owner %}
   
		{% if pester_first_photo %}
		<br/>
		<div class="no-photo-box">
		<div class="no-photo-box-image"><img src="/static/img/upload-a-photo.png"/></div>
		<div class="no-photo-box-main">
		<div class="no-photo-box-close"><a href="?close_tip_first_photo=1" class="meta close_tip" id="close_tip_first_photo">close</a></div>
		<p>*Why hide behind an icon - show the world your real face!</p>
		<a class="major-notice" href="profileupload/">Upload a profile photo now!</a>
		</div>
		</div>
		{% endif %}

		{% if pester_first_diary_entry %}
		<div class="no-photo-box">
		<br/>
		<div class="no-photo-box-image"><img src="/static/img/edit_page.png"/></div>
		<div class="no-photo-box-main">
		<div class="no-photo-box-close"><a href="?close_tip_first_diary_entry=1" class="meta close_tip" id="close_tip_first_diary">close</a></div>
		<p>*Use the site to keep a record of your training experiences.</p>
		<a class="major-notice" href="diary/add/">Write your first diary entry</a>
		</div>
		</div>
		<br/>
		{% endif %}
                                
	{% endif %}

	{% if person.photo %}
		<div class="profile-photo">
		<img src="{% thumbnail person.photo 150x150 crop %}" alt="{{ person }}">
		</div>
	{% else %}
		<div class="profile-photo">
		<a href="profileupload/"><img src="/static/img/upload-a-photo.png" alt="upload a photo!"></a>
		</div>
	{% endif %}

		<div class="profile-text">
		<a href="/{{ person.country.iso_code|lower }}/" class="small-text">
		<img src="/img/flags/{{ person.country.iso_code|lower }}.gif" alt="{{ person.country }}" title="{{ person.country }}" width="16" height="11" class="flag country-name"></a>
		<span class="region">{{ person.location_description }}</span><br/>

	{% if styles %}
		<span class="small-text"><strong>Styles: </strong>
		{% for style in styles %} 
		<a href="{{ style.get_absolute_url }}">{{ style.name|title }}</a>{% if not forloop.last %}, {% endif %}
		{% endfor %}
		</span><br/>
	{% endif %}

               
	{% if clubs %}
		    <span class="small-text"><strong>Club{{ clubs.count|pluralize }}:</strong>
		    {% for club in clubs %}
		        {% if club.url %} 
		        <a href="{{ club.get_absolute_url }}" rel="nofollow">{{ club.name }}</a>{% if not forloop.last %}, {% endif %}
		        {% else %}
    		        {{ club.name }}{% if not forloop.last %}, {% endif %}
 		        {% endif %}
   		    {% endfor %}
		    </span><br/>
	{% endif %}


	{% if person.bio %}
              	<span class="small-text">
		<strong>Bio:</strong> {% filter linebreaks %}{{ person.bio|urlize|truncatewords:"50" }}{% endfilter %}
		</span>
	{% else %}
		{% if is_owner %}
		<p>You haven't written a bio yet - <a href="/{{ user.username }}/profile/">why not introduce yourself a little?</a></p>
		{% else %}
		{% endif %}
	{% endif %}

	</div>
	</div>

	<div id="main-content-area">


	{% if diary_entries_private %}
		<div class="highlight-profile">
		<h4>{{ PROJECT_MARTIAL_ART|title }} diary 
		{% if is_owner %}(<a href="/{{ user.username }}/diary/add">add another entry</a>)
		{% endif %}
		</h4>	
		{% if is_owner %}
			<ul class="diary-list">
			{% for entry in diary_entries_private %}
			<li class="diary-list">
			<a class="diary-title" href="diary/{{ entry.slug }}/">{{ entry.title }}</a> 
			{% if is_owner %}<a href="/{{ person.user.username }}/diary/{{ entry.slug }}/edit/">(edit)</a> 
			<a href="/{{ person.user.username }}/diary/{{ entry.slug }}/delete/">
			<img class="delete" src="/static/img/delete.png">
			</a>{% endif %}
			<br/>
			<p class="diary-summary-text">{{ entry.content|striptags|truncatewords:20 }}</p>
			<p class="meta">{{ entry.date_added|date:"d M Y" }}  |</p>
			{% if not forloop.last %}
			<div class="line"></div>
			{% endif %}
			</li>
			{% endfor %}
			</ul>		
	{% else %}
			<ul class="diary-list">
				{% for entry in diary_entries_public %}
				<li class="diary-list">
				<a class="diary-title" href="diary/{{ entry.slug }}/">{{ entry.title }}</a> {% if is_owner %}<a href="/{{ person.user.username }}/diary/{{ entry.slug }}/edit/">(edit)</a> <a href="/{{ person.user.username }}/diary/{{ entry.slug }}/delete/"><img src="/static/img/delete.png"></a>{% endif %}<br/>
				<p class="diary-summary-text">{{ entry.content|striptags|truncatewords:20 }}</p>
				<p class="meta">{{ entry.date_added|date:"d M Y" }}  |</p>
				{% if not forloop.last %}
				<div class="line"></div>
				{% endif %}
				</li>
				{% endfor %}
				</ul>	
			{% endif %}
		</div>
		{% endif %}

			

		{% if photos %}
		<div class="highlight-profile">
		<h4>{{ person.user.first_name }}'s photos 
		{% if is_owner %}(<a href="/{{ user.username }}/photo/upload">add more photos</a>)
		{% endif %}
		</h4>
		<ul class="thumbnail-list">
		{% for photo in photos %}
		<li class="thumbnail-list">
		<a href="{{ photo.get_absolute_url }}">
		<img src="{% thumbnail photo.photo 60x60 crop %}">
		</a>
		</li>
		{% endfor %}
		</ul>
		</div>
		{% endif %}
       
	</div>
	</div>


	<div id="right-column">
            {% with person.get_nearest as people %}
            {% if people %}
            <h4>People near {{ person.user.first_name }}</h4>
            
	<div id="horizontal-image-listing">
            <ul class="horizontal-image-list">
                {% for person in people %}
                <li class="horizontal-image-list">
		<div class="list-photo">
                    <a href="{{ person.get_absolute_url }}"><img src="{% if person.photo %}{% thumbnail person.photo 60x60 crop %}{% else %}/static/img/person_small_blank.png{% endif %}" alt="{{ person }}"></a>
		</div>
                </li>
                {% endfor %}
            </ul>
	</div>
            {% endif %}
            {% endwith %}
	</div>
	



{% endblock %}
